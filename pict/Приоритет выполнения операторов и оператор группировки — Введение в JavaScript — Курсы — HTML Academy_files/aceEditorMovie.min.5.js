!function(t){function o(t){t.preventDefault(),t.stopPropagation()}String.prototype.repeat||(String.prototype.repeat=function(t){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var o=""+this;if(t=+t,t!=t&&(t=0),0>t)throw new RangeError("repeat count must be non-negative");if(t==1/0)throw new RangeError("repeat count must be less than infinity");if(t=Math.floor(t),0==o.length||0==t)return"";if(o.length*t>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var i="";1==(1&t)&&(i+=o),t>>>=1,0!=t;)o+=o;return i});var i=function(t){this.editor=t,this.theme=t.getTheme(),this.theme&&(this.theme=this.theme.split("/")[2]),this.tooltip=null,this.tooltipContainer=null,this.fadeAwayTime=1e3,this.init()};i.prototype.init=function(){var t=ace.require("ace/line_widgets").LineWidgets;this.session=this.editor.getSession(),this.session.widgetManager||(this.session.widgetManager=new t(this.session),this.session.widgetManager.attach(this.editor)),this.tooltipContainer=document.createElement("div"),this.tooltipContainer.classList.add("tooltip-answer"),this.theme&&this.tooltipContainer.classList.add("tooltip-answer_theme_"+this.theme),this.runCallback=this.runCallback.bind(this),this.tooltip={row:0,fixedWidth:!0,coverGutter:!1,el:this.tooltipContainer}},i.prototype.show=function(t,o){var i=t.tooltip,e=this.tooltip.row=t.tooltipPosition.row,s=this.editor.getFirstVisibleRow(),n=this.editor.getLastVisibleRow(),r=(n-s)/2;e>=n?(i+="<br><br><br>",this.editor.scrollToRow(e+r)):s>=e&&this.editor.scrollToRow(e-r),this.tooltipContainer.innerHTML=i,this.session.widgetManager.addLineWidget(this.tooltip),this.tooltipContainer.classList.add("tooltip-answer_visible"),o()},i.prototype.hide=function(t){this.tooltipContainer.classList.remove("tooltip-answer_visible"),this.callback=t,this.session.on("changeFold",this.runCallback),setTimeout(function(){this.session.widgetManager.removeLineWidget(this.tooltip)}.bind(this),this.fadeAwayTime)},i.prototype.runCallback=function(){this.session.off("changeFold",this.runCallback),this.callback()};var e=function(t,o){this.logData={isFirstRun:!0,startDate:new Date,skipMethods:["addAction"]},this.codeTypeInterval=130,this.sameLineActionBooster=10,this.actionRunInterval=o,this.windowScrollTo="#preview",this.editor=t,this.$editorContainer=$(t.container),this.editorOffset=this.$editorContainer.offset(),this._editor_saved_options={};var e=this.editor.find;this.editor.find=function(){var o=e.apply(this.editor,arguments);return this.editor._emit("cursor:positioned",t,o),o}.bind(this),this.actions=[],this.tooltip=new i(this.editor),this.typeCodeAsync=this.typeCodeAsync.bind(this),this.setMotions()};e.prototype.setData=function(t){this.log({name:"setData",args:{data:t}}),this.tooltipText=t.tooltip,Array.isArray(t.actions)||(t.actions=[t.actions]),t.actions.forEach(function(o){o.tooltip=o.tooltip||t.tooltip,this.addAction(o)},this)},e.prototype.addAction=function(t){return this.log({name:"addAction",args:{data:t}}),this.actions.push({name:t.action,data:t}),this},e.prototype.start=function(t){function o(){var i=s.actions[e];if(i){var n=s.actionRunInterval,r=i.data.cursorPosition,a=s.actions[e+1],d=a&&a.data.cursorPosition||{};d.row===r.row&&(n/=s.sameLineActionBooster),s.motions[i.name](i.data,function(){setTimeout(o,n)})}else s.stop(t);e+=1,s.alignEditorViewport()}this.log({name:"start",args:{callback:t}}),this.editorOnMovie("start");var i,e=0,s=this,n=s.actions[0],r=n.data.cursorPosition,a={addLine:-1};i={row:r.row+(a[n.name]||0)},s.tooltip.show({tooltip:this.tooltipText,tooltipPosition:i},function(){setTimeout(o,s.actionRunInterval)})},e.prototype.stop=function(t){this.log({name:"stop",args:null}),this.editorOnMovie("stop"),this.tooltip.hide(t)},e.prototype.alignEditorViewport=function(){var t=4,o=this.editor.getCursorPosition().row,i=this.editor.getFirstVisibleRow()+1,e=this.editor.getLastVisibleRow()+1;i>=o?this.editor.scrollToRow(i-t):o>=e&&this.editor.scrollToRow(o+t)},e.prototype.setMotions=function(){var t=this;t.motions={replace:function(o,i){t.log({name:"motions.replace",args:{data:o,next:i}});var e=(o.cursorPosition.row||0,o.from.string||o.from);t.editor.moveCursorToPosition(o.cursorPosition);var s=t.editor.find(e);return s?(t.editor.remove(),void t.typeCodeAsync(o.to,i)):i()},"delete":function(o,i){t.log({name:"motions.delete",args:{data:o,next:i}}),t.editor.moveCursorToPosition(o.cursorPosition),t.editor.find(o.from),t.editor.remove(),i()},addLine:function(o,i){t.log({name:"motions.addLine",args:{data:o,next:i}});var e=o.cursorPosition.row,s=o.cursorPosition.column,n=" ".repeat(s),r=t.editor.getSession().doc.insertMergedLines({row:e-1},["",n]);t.editor.moveCursorToPosition(r),t.typeCodeAsync(o.to,i)},add:function(o,i){t.log({name:"motions.add",args:{data:o,next:i}}),t.editor.moveCursorToPosition(o.cursorPosition),t.typeCodeAsync(o.to,i)}}},e.prototype.setCursorFreezing=function(t){var i=this.$editorContainer.find(".ace_content");return t?i.on("mousedown keydown",o):i.off("mousedown keydown",o),this},e.prototype.disableEditorAutoCloseTags=function(){var t=this.editor.getSession().getMode().$behaviour;return this._editor_saved_options.autoclosing=t.$behaviours.autoclosing,t.remove("autoclosing"),this},e.prototype.restoreEditorAutoCloseTags=function(){var t=this.editor.getSession().getMode().$behaviour,o=this._editor_saved_options.autoclosing;return o&&(t.$behaviours.autoclosing=o),this},e.prototype.editorOnMovie=function(t){switch(t){case"start":this.setCursorFreezing(!0).disableEditorAutoCloseTags();break;case"stop":this.setCursorFreezing(!1).restoreEditorAutoCloseTags()}},e.prototype.typeCodeAsync=function(t,o){function i(t){setTimeout(function(){s.editor.insert(t),e&&(s.editor._emit("cursor:positioned",s.editor,t),e=!1),t=n.shift(),t?i(t):"function"==typeof o&&o()},s.codeTypeInterval)}this.log({name:"typeCodeAsync",args:{code:t,next:o}});var e=!0,s=this,n=t.split(""),r=n.shift();i(r)},e.prototype.log=function(o){t.isAceEditorMovieLog&&(this.logData.isFirstRun&&(console.log("start logging at: ",this.logData.startDate.getHours()+":"+this.logData.startDate.getMinutes()+":"+this.logData.startDate.getSeconds()),this.logData.isFirstRun=!1),"all"!==this.logData.skipMethods&&-1===this.logData.skipMethods.indexOf(o.name)&&console.log(Date.now()-this.logData.startDate+" ms",o))},t.aceEditorMovie||(t.aceEditorMovie=e)}(this);
