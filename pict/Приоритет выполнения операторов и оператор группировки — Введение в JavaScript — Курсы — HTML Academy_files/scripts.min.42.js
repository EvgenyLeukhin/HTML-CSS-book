function getHashFromString(e){for(var t=0,s=e.length,i=0;s>i;i++)t=31*t+e.charCodeAt(i),t&=t;return t}function upperCaseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function TaskProcessor(e){e&&(this.goalsQuantity=e);var t=this;$("#server-check").click(function(){t.initServerCheck()}),-1!==location.href.indexOf("scdebug")&&(this.debug=!0),t.taskStartedTime=new Date}function initCustomTabs(){$(".tabs-container").each(function(){$(this).find(".tab-content").hide(),$(this).find(".tab-toggle").each(function(e){$(this).click(function(){$(this).parent().find(".tab-toggle").removeClass("tab-toggle-active"),$(this).addClass("tab-toggle-active"),$(this).parent().find(".tab-content").hide(),$(this).parent().find(".tab-content:eq("+e+")").show()})}),$(this).find(".tab-toggle:first").click()})}$(document).ready(function(){$(".b-simple-task").length&&($(".tip .tip-toggle").click(function(e){e.preventDefault(),$(this).parent().find(".tip-content").fadeIn(500)}),HtmlacademyTask.init(),initCustomTabs()),setTimeout(function(){AchievmentNotifier.check()},1e3),$(".visibility-button").tooltip()});var HtmlacademyTask={layout:"default",userSettings:{},userId:null,htmleditor:null,csseditor:null,processor:null,refreshTimer:null,autosaveTimer:null,savingEnabled:!1,saving:!1,reseting:!1,usePrefixFree:!1,useAutoprefixer:!1,useLess:!1,lessTree:null,compiledCssViewer:null,preprocessor:{},experimentEnabled:!1,experimentOptions:{},initialHtml:null,initialCss:null,renderedCodeHash:null,answers:null,buttonAnswersFreezeTimeout:3e3,buttonAnswersText:"Показать ответ",init:function(){var e=this;this.detectLayout(),this.initUserSettings(),this.initStorageKeys(),this.initHtmlEditor(),this.initCssEditor(),this.initGoalLabels(),this.initGoalPositionToggle(),$("#save-code").length&&(e.savingEnabled=!0),$("#save-code").click(function(t){e.saveCode(),t.preventDefault()}),$("#reset-code").click(function(t){e.resetCode(),t.preventDefault()}),$("#next-task").click(function(e){$(this).hasClass("disabled")&&e.preventDefault()}),$(".ha-task-description-toggle").click(function(e){$(".ha-task-description-popup").fadeIn(300),$(".ha-task-description-overlay").fadeIn(300),e.preventDefault()}),$(".ha-task-description-overlay").click(function(e){$(".ha-task-description-popup").fadeOut(300),$(".ha-task-description-overlay").fadeOut(300),e.preventDefault()}),$(".ha-task-description-close").click(function(e){$(".ha-task-description-popup").fadeOut(300),$(".ha-task-description-overlay").fadeOut(300),e.preventDefault()}),document.addEventListener("keydown",function(e){27==e.keyCode&&($(".ha-task-description-popup").fadeOut(300),$(".ha-task-description-overlay").fadeOut(300),event.preventDefault())}),e.changed=!0,setTimeout(function(){e.updatePreview(),$(".ha-task-description-popup").fadeIn(300),$(".ha-task-description-overlay").fadeIn(300)},300)},detectLayout:function(){var e=$(".b-simple-task:first");e.hasClass("ha-quest-task")&&(this.layout="quest")},initUserSettings:function(){var e={theme:"default",fontsize:"12px",keybinding:0,highlightselectedword:0,showinvisibles:0,codefolding:0,autoclosetags:0};this.userSettings=e;var t=$(".b-simple-task:first");if(t.length){var s=t.data();if(s){for(key in this.userSettings)void 0!==s[key]&&(this.userSettings[key]=s[key]);s.userid&&(this.userId=s.userid)}}},initStorageKeys:function(){if(this.userId){var e=localStorage.getItem("ha_updated_keys");e||(this.updateStorageKeys(),localStorage.setItem("ha_updated_keys",!0))}},enableExperiment:function(e){this.experimentEnabled=!0,this.experimentOptions=e},setTaskProcessor:function(e){this.experimentEnabled&&(e.setSubjectId(this.experimentOptions.subjectId),e.setAbModeId(this.experimentOptions.abModeId),this.experimentOptions.autoCheck?e.enableAutoCheck():e.disableAutoCheck(),e.enableTracking(),this.updateExperimentLabels()),this.taskProcessor=e,this.taskProcessor.task=this},updateExperimentLabels:function(){("ac-st"==this.experimentOptions.abModeId||"mc-st"==this.experimentOptions.abModeId)&&$('.ha-task-goals li[id^="goal"]:first .ha-goal-label').text("Задачи")},initPreprocessor:function(){this.useLess&&(this.preprocessor=new less.Parser,this.preprocessor.name="LESS",this.csseditor.getSession().setMode("ace/mode/less"),this.initCompiledCodeViewer())},initHtmlEditor:function(){if($("#html-editor").length){if(this.htmleditor=ace.edit("html-editor"),this.htmleditor.getSession().setMode("ace/mode/html"),this.initCommonEditorSettings(this.htmleditor),this.initHtmlEditorSettings(this.htmleditor),this.initialHtml=this.htmleditor.getSession().getValue(),"undefined"!=typeof Storage){var e=localStorage.getItem(this.getStorageKey()+"_html");null!=e&&this.htmleditor.getSession().setValue(e)}$("#html-editor").parent().hasClass("blocked")&&this.htmleditor.setReadOnly(!0);var t=this;this.htmleditor.on("change",function(){clearTimeout(t.refreshTimer),clearTimeout(t.autosaveTimer),t.refreshTimer=setTimeout(function(){t.updatePreview()},1e3),t.autosaveTimer=setTimeout(function(){t.saveCode()},3e3),t.notify("html_changed")}),this.htmleditor.on("focus",function(){t.notify("html_focused")}),$(window).resize(function(){t.htmleditor.resize()})}},getHtmlCode:function(){return this.htmleditor.getSession().getValue()},initCssEditor:function(){if($("#css-editor").length){var e=this;if(this.csseditor=ace.edit("css-editor"),this.csseditor.getSession().setMode("ace/mode/css"),this.initCommonEditorSettings(this.csseditor),this.initCssEditorSettings(this.csseditor),this.initialCss=this.csseditor.getSession().getValue(),"undefined"!=typeof Storage){var t=localStorage.getItem(this.getStorageKey()+"_css");null!=t&&this.csseditor.getSession().setValue(t)}$("#css-editor").parent().hasClass("blocked")&&this.csseditor.setReadOnly(!0),this.csseditor.on("change",function(){clearTimeout(e.refreshTimer),clearTimeout(e.autosaveTimer),e.refreshTimer=setTimeout(function(){e.updatePreview()},1e3),e.autosaveTimer=setTimeout(function(){e.saveCode()},3e3),e.notify("css_changed")}),this.csseditor.on("focus",function(){e.notify("css_focused")}),$(window).resize(function(){e.csseditor.resize()})}},initCommonEditorSettings:function(e){e.$blockScrolling=1/0,e.setHighlightActiveLine(!1),e.setDisplayIndentGuides(!1),e.setShowPrintMargin(!1),e.setFadeFoldWidgets(!1),e.getSession().setUseWrapMode(!0),e.getSession().setUseWorker(!1),e.renderer.setHScrollBarAlwaysVisible(!1),e.setFontSize(this.userSettings.fontsize),e.setHighlightSelectedWord(this.userSettings.highlightselectedword),e.setShowInvisibles(this.userSettings.showinvisibles),this.userSettings.codefolding?(e.setShowFoldWidgets(!0),e.getSession().setFoldStyle("markbegin")):e.getSession().setFoldStyle("manual"),"default"!==this.userSettings.theme&&e.setTheme(this.userSettings.theme)},initHtmlEditorSettings:function(e){if(!this.userSettings.autoclosetags){var t=e.getSession().getMode();t.$behaviour.remove("autoclosing")}},initCssEditorSettings:function(e){e.setBehavioursEnabled(!1)},initCompiledCodeViewer:function(){$("#css-editor").before('<pre id="compiled-css" style="position:absolute;width:100%;height:100%;z-index:100;top:0;left:0;box-sizing:border-box;overflow-y:auto;"></pre>'),this.compiledCssViewer=$("#compiled-css"),this.compiledCssViewer.hide();var e=this,t=$(".css-switch");t.on("click",function(s){s.preventDefault(),$("#compiled-css:visible").length?t.removeClass("label-info"):t.addClass("label-info"),e.compiledCssViewer.toggle()})},initGoalLabels:function(){$('.ha-task-goals li[id^="goal"]').each(function(e){$(this).prepend('<span class="label ha-goal-label">Цель '+(e+1)+"</span> ")}),$('.ha-task-goals li[id="bonus"]').each(function(e){$(this).prepend('<span class="label ha-goal-label">Бонус</span>')})},initGoalPositionToggle:function(e){$(".ha-goals-position-toggle").length&&$(".ha-goals-position-toggle").click(function(){$(this).parent().toggleClass("ha-task-goals-top")})},updatePreview:function(){var e=this,t=this.getPreviewDocument(),s=this.getPreviewWindow();if(s&&t)var i=s.pageXOffset,o=s.pageYOffset;if(t.open(),t.write(this.htmleditor.getSession().getValue()),t.close(),this.csseditor){if(this.useLess){this.injectLess(t,this.csseditor.getSession().getValue());var n=this.compileCssCode()}else var n=this.csseditor.getSession().getValue();this.usePrefixFree&&(n=PrefixFree.prefixCSS(n,!0)),this.injectCss(t,n)}e.notify("browser_updated"),this.updatePagetitle(),s&&t&&s.scrollTo(i,o)},compileCssCode:function(){var e=this,t=e.csseditor.getSession(),s=t.getValue(),i="";e.compiledCssViewer.text("");try{this.preprocessor.parse(s,function(s,o){return s?(e.compiledCssViewer.text("Ошибка разбора LESS"),void e.highlightError(s)):(i=o.toCSS(),e.lessTree=o,t.getAnnotations().length&&t.clearAnnotations(),void e.compiledCssViewer.text(i))})}catch(o){e.compiledCssViewer.text("Ошибка разбора LESS"),this.highlightError(o.line,o.column,o.message)}return i},injectCss:function(e,t){var s=e.createElement("style");s.type="text/css",s.styleSheet?s.styleSheet.cssText=t:s.appendChild(e.createTextNode(t)),e.getElementsByTagName("head")[0].appendChild(s)},injectLess:function(e,t){var s=e.createElement("script"),i=String(t).replace(/(\r\n|\n|\r)/gm,"");i='var lessCode = "'+i.replace(/"/gm,'\\"')+'";';document.createTextNode(i);s.type="text/javascript",s.appendChild(e.createTextNode(i)),e.body.appendChild(s)},highlightError:function(e,t,s){this.csseditor.getSession().setAnnotations([{row:e-1,column:t,text:s,type:"error"}])},updatePagetitle:function(){var e=$("title",this.getPreviewDocument()).text();e&&e.length?e+=" — HTML Academy":e="HTML Academy",e=$('<div title="'+e.replace(/"/g,"&quot;")+'" class="title-container"></div>').text(e),$(".browser-container:first .tab:first").html(e)},getPreviewDocument:function(){var e=document.getElementById("preview");return e.contentDocument||e.contentWindow.document},getPreviewWindow:function(){var e=document.querySelector("#preview");return e.contentWindow},notify:function(e){"browser_updated"===e&&this.checkIfCodeHashChanged(),this.taskProcessor&&this.taskProcessor.on&&this.taskProcessor.on(e)},enableReloadButton:function(){$(".browser-container").prepend('<span class="btn reload-browser"><i class="icon-refresh"></i></span>');var e=this;$(".browser-container .reload-browser").click(function(){e.changed=!0;var t=document.querySelector("#preview"),s=t.parentNode;s.removeChild(t),s.appendChild(t),e.updatePreview()})},enablePrefixFree:function(){this.usePrefixFree=!0},enableAutoprefixer:function(){this.useAutoprefixer=!0},enableLess:function(){this.useLess=!0},saveCode:function(){var e=this;e.savingEnabled&&($("#save-code").addClass("disabled"),$("#save-code").text("Сохраняем"),"undefined"!=typeof Storage?(localStorage.setItem(e.getStorageKey()+"_html",e.htmleditor.getSession().getValue()),localStorage.setItem(e.getStorageKey()+"_css",e.csseditor.getSession().getValue()),$("#save-code").addClass("btn-success"),$("#save-code").text("Сохранено"),e.resetSaveBtn()):($("#save-code").addClass("btn-danger"),$("#save-code").text("Ошибка сохранения"),e.resetSaveBtn()))},getStorageKey:function(){if(this.userId>0)var e="ha_user_"+this.userId;else var e="ha";return e+window.location.pathname.replace(/\//g,"_")},updateStorageKeys:function(){var e=/^ha\_[a-z]+\_[0-9]+\_[a-z]+\_[0-9]+\_(html|css)$/;for(var t in localStorage)if(e.test(t)){var s="ha_user_"+this.userId+t.replace(/^ha/,"");localStorage.setItem(s,localStorage.getItem(t)),localStorage.removeItem(t)}},resetSaveBtn:function(){setTimeout(function(){$("#save-code").text("Сохранить код"),$("#save-code").removeClass("btn-success"),$("#save-code").removeClass("btn-danger"),$("#save-code").removeClass("disabled")},1e3)},resetCode:function(){"undefined"!=typeof Storage&&(localStorage.removeItem(this.getStorageKey()+"_html"),localStorage.removeItem(this.getStorageKey()+"_css")),this.htmleditor.getSession().setValue(this.initialHtml),this.csseditor.getSession().setValue(this.initialCss)},composeCheckedCode:function(){var e=this.getPreviewDocument();if(e.open(),e.write(this.htmleditor.getSession().getValue()),e.close(),this.csseditor){if(this.useLess){this.injectLess(e,this.csseditor.getSession().getValue());var t=this.compileCssCode()}else var t=this.csseditor.getSession().getValue();if(this.useAutoprefixer)try{t=autoprefixer("Chrome 4").process(t).css}catch(s){}this.injectCss(e,t)}var i=$(e).find("html").html();return this.updatePreview(),i},checkIfCodeHashChanged:function(){var e=this.getCodeForHash(),t=getHashFromString(e),s=this.getRenderedCodeHash();s?t!==s?HtmlacademyChallenge.showUpdateAlert():HtmlacademyChallenge.hideUpdateAlert():this.setRenderedCodeHash(t)},getRenderedCodeHash:function(){return this.renderedCodeHash},setRenderedCodeHash:function(e){return this.renderedCodeHash=e,this},getCodeForHash:function(){var e=this.htmleditor.getSession().getValue();return this.csseditor&&(e+=this.csseditor.getSession().getValue()),e},addAnswers:function(e){this.answers=e;var t=$('<a class="btn disabled ha-task-show-answer">'+this.buttonAnswersText+"</a>");$(".ha-task-controls").append(t),t.click(function(){var e=$(this);e.hasClass("disabled")||(e.addClass("disabled"),HtmlacademyTask.showAnswers(function(){e.removeClass("disabled")}))}),setTimeout(function(){t.removeClass("disabled")},this.buttonAnswersFreezeTimeout)},showAnswers:function(e){if(this.answers&&!(this.answers.length<1)&&aceEditorMovie){var t=this,s=[],i=1,o=2e3,n=t.taskProcessor.autoCheckEnabled;t.answers.forEach(function(e){var i=e.editor,n=e.data,a=e.showInterval||o,r=t[i+"editor"],c=new aceEditorMovie(r,a);c.setData(n),s.push(c)}),t.resetCode(),function a(){var o,r=s.shift();r&&(t.taskProcessor.autoCheckEnabled=!1,r.start(function(){o=0===s.length,t.taskProcessor.setGoalCompletedWithAnswer("goal"+i),i+=1,o?(t.taskProcessor.autoCheckEnabled=n,e&&e()):a()}))}()}}};TaskProcessor.prototype={task:null,completed:!1,goals:{},goalsQuantity:0,checking:!1,debug:!1,bonusGoalExists:!1,bonusGoalAlreadyCompleted:!1,taskStartedTime:0,autoCheckEnabled:!0,trackingEnabled:!1,subjectId:"unknown",abModeId:"default",on:function(e){if("browser_updated"==e&&this.goalsQuantity){var t=this;setTimeout(function(){t.checkGoals()},200)}},setSubjectId:function(e){this.subjectId=e},setAbModeId:function(e){this.abModeId=e},enableAutoCheck:function(){this.autoCheckEnabled=!0},disableAutoCheck:function(){this.autoCheckEnabled=!1},enableTracking:function(){this.trackingEnabled=!0},disableTracking:function(){this.trackingEnabled=!1},getPreviewDocument:function(){var e=document.getElementById("preview");return e.contentDocument||e.contentWindow.document},getPreviewWindow:function(){var e=document.querySelector("#preview");return e.contentWindow},getHtmlEditor:function(){return this.task?this.task.htmleditor:null},getCssEditor:function(){return this.task?this.task.csseditor:null},checkGoals:function(){if(this.autoCheckEnabled&&this.goalsQuantity){for(var e=1;e<=this.goalsQuantity;e++){var t="goal"+e;if(!this.goals[t]){var s="checkGoal"+e;this[s]&&this[s]()&&(this.goals[t]=!0,this.goalCompleted(t))}}this.checkBonusGoal()}},goalCompleted:function(e){this.markGoalCompleted(e),this.checkTaskCompleted()},markGoalCompleted:function(e){var t=$("#"+e+" span");t.fadeTo(500,.5,function(){t.removeClass("label-important"),t.addClass("label-warning"),t.fadeTo(500,1)})},markGoalFailed:function(e){var t=$("#"+e+" span");t.fadeTo(500,.5,function(){t.addClass("label-important"),t.removeClass("label-warning"),t.fadeTo(500,1)})},checkTaskCompleted:function(){if(!this.completed){if(!this.goalsQuantity)return!1;for(var e=1;e<=this.goalsQuantity;e++){var t="goal"+e;if(!this.goals[t])return!1}this.taskCompleted()}},taskCompleted:function(){if(!this.completed){var e=this;$.post(location.href,{completed:1},function(t,s,i){e.completed=!0,e.showBonusGoal(!1),e.debug||($("#server-check").hide(),$("#server-check").next(".tip").hide()),$(".task-completed").fadeIn(500),$("#next-task").removeClass("disabled"),$("#next-task").addClass("btn-success"),setTimeout(function(){AchievmentNotifier.check()},1e3)},"json"),this.track("task_completed")}},setGoalCompletedWithAnswer:function(e){this.goals[e]=!0,this.goalCompleted(e)},enableBonusGoal:function(){this.bonusGoalExists=!0},checkBonusGoal:function(){if(this.bonusGoalExists&&!this.bonusGoalAlreadyCompleted){var e="checkGoalBonus";this[e]&&this[e]()&&this.bonusGoalCompleted()}},bonusGoalCompleted:function(){if(this.bonusGoalExists&&!this.bonusGoalAlreadyCompleted){this.bonusGoalAlreadyCompleted=!0,this.showBonusGoal(!0);var e=$("#bonus span:first");e.fadeTo(500,.5,function(){e.removeClass("label-important"),e.addClass("label-warning"),e.fadeTo(500,1)});$.post(location.href,{bonus_completed:1},function(e,t,s){setTimeout(function(){AchievmentNotifier.check()},1e3)},"json")}},showBonusGoal:function(e){this.bonusGoalExists&&(!e&&this.getRandom(1,100)>20||$(".ha-task-goals .bonus-goal:visible").length||$(".ha-task-goals .bonus-goal").fadeIn(300))},getRandom:function(e,t){return Math.random()*(t-e)+e},compareStrings:function(e,t){return e&&t?(e=$.trim(e.toLowerCase()),t=$.trim(t.toLowerCase()),e===t):!1},initServerCheck:function(){var e=this;if(!e.checking){e.checking=!0,$("#server-check").addClass("disabled"),$("#server-check span").text("Проверяем...");var t=HtmlacademyTask.composeCheckedCode();$.post(location.href,{html:t},function(t,s,i){e.processServerCheckResults(t),e.checking=!1,$("#server-check").removeClass("disabled"),$("#server-check span").text("Проверить")},"json"),this.track("server_check")}},processServerCheckResults:function(e){if(e&&(this.debug&&this.logDebug(e.raw),e.goals)){if(e.completed>0){for(var t=1;t<=this.goalsQuantity;t++){var s="goal"+t;this.goals[s]=!0,this.markGoalCompleted(s)}return this.completed=!0,this.debug||($("#server-check").hide(),$("#server-check").next(".tip").hide()),$(".task-completed").fadeIn(500),$("#next-task").removeClass("disabled"),$("#next-task").addClass("btn-success"),setTimeout(function(){AchievmentNotifier.check()},1e3),void this.track("task_completed")}for(var t=1;t<=this.goalsQuantity;t++){var s="goal"+t;this.goals[s]||(e.goals[s]||this.markGoalFailed(s),"fail"==e.goals[s]&&this.markGoalFailed(s),"ok"==e.goals[s]&&(this.goals[s]=!0,this.goalCompleted(s)))}}},logDebug:function(e){$(".debug-console").length||$(".browser-container").after('<div class="debug-console"></div>'),$(".debug-console").empty(),$(".debug-console").html("<pre>"+e+"</pre>")},getSupportedCssProp:function(e){for(var t=["","-webkit-","-moz-","-o-","-ms-","-khtml-"],s=document.documentElement,i=0;i<t.length;i++){var o=this.camelCase(t[i]+e);if("Ms"==o.substr(0,2)&&(o="m"+o.substr(1)),o in s.style)return o}},camelCase:function(e){return e.replace(/\-([a-z])/gi,function(e,t){return t.toUpperCase()})},track:function(e){if(this.trackingEnabled){var t=new Date,s={task_path:location.pathname,subject_id:this.subjectId,ab_mode_id:this.abModeId,event_type:e,event_time:t.getTime(),task_start_time:this.taskStartedTime.getTime(),work_duration:t.getTime()-this.taskStartedTime.getTime()};$.get("/api/track",s)}}};var HtmlacademyChallenge={layout:"default",evaluating:!1,limitsExpired:!1,instructionScreenHtml:'<div class="introduction-screen js-introduction-screen"><p><strong>Внимание! Это испытание!</strong></p><p>В испытаниях серверный результат и шкала сравнения обновляются только после нажатия кнопки проверки. Если текущий код отличается от кода серверного результата, вы увидите:</p><p><span class="btn demo-toggle need-reaction">Результат</span> <span class="btn demo-btn need-reaction"><i class="icon-check"></i> Проверить</span></p><p>Тогда снова нажмите кнопку проверки, чтобы обновить результат.</p><hr><p><span class="btn btn-success js-introduction-screen__close">Закройте подсказку, приступаю к испытанию!</span></p><label class="introduction-screen__no-more js-introduction-screen-no-more"><input type="checkbox"> Я запомнил, больше не показывайте этот экран.</label></div>',init:!0,init:function(){var e=this;e.detectLayout(),e.initViewModes(),$("a#check").click(function(){return e.evaluate(!0),e.hideUpdateAlert(),!1}),setTimeout(function(){e.evaluate(!1)},1e3)},detectLayout:function(){var e=$(".b-simple-task:first");e.hasClass("ha-quest-challenge")&&(this.layout="quest")},initViewModes:function(){if("quest"==this.layout){var e=this;$(".ha-challenge-toggle-original").click(function(t){e.toggleViewMode("original"),t.preventDefault()}),$(".ha-challenge-toggle-server-view").click(function(t){e.toggleViewMode("server-view"),t.preventDefault()}),$(".ha-challenge-toggle-overlay").click(function(t){e.toggleViewMode("overlay"),t.preventDefault()}),$(".ha-challenge-toggle-diff").click(function(t){e.toggleViewMode("diff"),t.preventDefault()}),e.toggleViewMode("original"),e.showIntroduction()}},showIntroduction:function(){if(!localStorage.getItem("ha_introduction_screen_disabled")){$(".ha-challenge-view-controls").before(this.instructionScreenHtml);var e=this,t=$(".js-introduction-screen"),s=$(".js-introduction-screen-no-more input"),i=$(".js-introduction-screen__close");t.addClass("introduction-screen_visible"),i.on("click",function(){e.hideIntroduction()}),s.on("change",function(e){e.preventDefault(),"undefined"!=typeof Storage&&localStorage.setItem("ha_introduction_screen_disabled",!0)})}},hideIntroduction:function(){var e=$(".js-introduction-screen"),t=$(".js-introduction-screen-no-more input"),s=$(".js-introduction-screen__close");e.removeClass("introduction-screen_visible"),s.off("click"),t.off("change")},toggleViewMode:function(e){$(".ha-challenge-view-controls button").removeClass("active"),$(".ha-challenge-toggle-"+e).addClass("active"),$(".ha-challenge-view-mode").hide(),$(".ha-challenge-mode-"+e).show()},evaluate:function(e){var t=this;if(!t.evaluating&&!t.limitsExpired){t.evaluating=!0,$("#resultbar").parent().addClass("active");var s=HtmlacademyTask.composeCheckedCode(),i={html:s};t.init||(i.check=1),e&&(i.real_attempt=1);var o=HtmlacademyTask.getCodeForHash(),n=getHashFromString(o);$.post(location.href,i,function(e,s,i){HtmlacademyTask.setRenderedCodeHash(n),t.processEvaluation(e),t.evaluating=!1,t.init=!1,$("#resultbar").parent().removeClass("active")},"json")}},getPreviewDocument:function(){var e=document.getElementById("preview");return e.contentDocument||e.contentWindow.document},processEvaluation:function(e){if(e){var t=parseInt(e.result);if(e.diff_image&&$("#diff").html('<img src="'+e.diff_image+"?"+Math.random()+'" alt="" />'),e.attempt_image&&$(".server-view").html('<img src="'+e.attempt_image+"?"+Math.random()+'" alt="" />'),70>t)return this.renderLowResult(t),void this.processLimits(e);if(90>t)return this.renderWarmResult(t),void this.processLimits(e);HtmlacademyTask.saveCode(),this.renderGoodResult(t),this.processLimits(e),setTimeout(function(){AchievmentNotifier.check()},1e3)}},renderLowResult:function(e){$("#resultbar").parent().removeClass("progress-success"),$("#resultbar").parent().removeClass("progress-info"),$("#resultbar").parent().addClass("progress-danger"),$("#resultbar").text("холодно"),$("#resultbar").css("width","50%")},renderWarmResult:function(e){$("#resultbar").parent().removeClass("progress-success"),$("#resultbar").parent().removeClass("progress-danger"),$("#resultbar").parent().addClass("progress-info"),$("#resultbar").text("теплее"),$("#resultbar").css("width",e+"%")},renderGoodResult:function(e){$("#resultbar").parent().removeClass("progress-danger"),$("#resultbar").parent().removeClass("progress-info"),$("#resultbar").parent().addClass("progress-success"),$("#resultbar").css("width",e+"%"),$("#resultbar").text(e+"%"),$(".task-completed").fadeIn(500),$("#next-task").removeClass("disabled"),$("#next-task").addClass("btn-success")},showUpdateAlert:function(){$(".ha-challenge-toggle-server-view").add("#check").addClass("need-reaction")},hideUpdateAlert:function(){$(".ha-challenge-toggle-server-view").add("#check").removeClass("need-reaction")},processLimits:function(e){if(!e.limits_disabled){var t=parseInt(e.limits_left);!t||1>t?(this.limitsExpired=!0,$("#check .limits").text(""),$("#check").addClass("disabled"),$(".no-limits-left").show()):$("#check .limits").text("("+t+")")}}},AchievmentNotifier={goalsMap:[{goal:"1task","class":"achievment-1"},{goal:"1course","class":"achievment-12"},{goal:"20tasks","class":"achievment-2"},{goal:"confirmed_email","class":"achievment-25"},{goal:"subscription","class":"achievment-27"}],check:function(){var e=this;$.ajax("/achievments",{type:"GET",cache:!1,data:{get_new_achievments:1},dataType:"json",success:function(t,s,i){e.processResponse(t)}})},processResponse:function(e){if(e&&e.achievments){if($(".achievment-notification .notification-container").empty(),e.achievments.length>1)var t='<div class="notification-title">Вы заработали достижения</div>';else var t='<div class="notification-title">Вы заработали достижение</div>';t+=e.achievments.join(" "),$(".achievment-notification .notification-container").html(t),this.notifyGoals(e),$(".achievment-notification").fadeIn(500),setTimeout(function(){$(".achievment-notification").fadeOut(500)},5e3),$(".achievment-notification").click(function(){$(this).fadeOut(500)})}},notifyGoals:function(e){if(yaCounter17207665){var t=this;$(".achievment-notification .notification-container .achievment").each(function(){t.checkAndNotifyGoal($(this),e)})}},checkAndNotifyGoal:function(e,t){$(this.goalsMap).each(function(){return e.hasClass(this["class"])?void yaCounter17207665.reachGoal(this.goal,{user_id:t.user_id}):void 0})}};
